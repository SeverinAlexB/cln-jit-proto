import {createGrpc} from '../cln/createGrpc'

jest.setTimeout(60*1000)

function hexToUint8Arr(hex: string): Uint8Array {
    return Uint8Array.from(Buffer.from(hex, 'hex'))
}




describe('sendonion', () => {

    test('send', async () => {
        const node = await createGrpc(undefined as any)

        const request = {
            onion: hexToUint8Arr('0003b095e38170e4a0c9a9201a7c5f3d405a6fbcafab064accc25f71f4348a1289daa6e739f46e81f3093e2dc24c1f6de61582c7befb33e6915eacabe8239fcdedaebf07368721dbdb926e5999506516d135b195e5b56412a5a0cdd2bbab0eacc44f4501372130452ab576b4f5cc16b3f4c8d2868bc38278a8219b986365cbeab4670bcf390db55f5f2628c79ae484c84038ed2936bd09ab50fd4dd2a047225ca044a90767c98c5453028dc1c19ff183438cc0bbedf1005522584b642bb89f2f52a0557c62d69096ebb27a14e12b9e11b73fa842b48821eac9e086c2a2d652b54d670d7c910b80eca6c39f8afd750eab85bbc375371b98ef089ec9b598dfb1d66ae538399b0971c2ddf252483cb27156f1abfd6ce61495d35be005fa6e284f8ff99457c52b8fc37c945ffc7b187393dd43a83ef2b9090751ddd9f85ec10811bfe189fd07ce837d2e1a4bca49fda6da2ab4013437341f16e6979e91e829f5f9de468be64a553c943fd55c3f88e06678772bf6d7662f8ded2486178a42d105da506e08ec0619ed7175a240564c0d6023c632f19b6471e0a73944da3df13efe2dc5705a0a9dce33ed9198d938c6bb17f8e321a8d1c7c84baf4d6d366c38623861561089676598ea1dba9077c955cafe291f1accc49c8ba38becdc6ee12dc44089e683340dcdb200814247dfe3102232609e6f0282b4d55c2e04be8bc7e65d90f9322438cb632788a3bcef846d9be1c06f9e74367c3d7d0ed28447ca25aad7ec0600d3066a4f2c1e7301b08d9ea4f9995e9424dcaa8256734fb2726f79c3144acb3b6a755ab80fcce0f345ad2e70491b379c597eca1b1a38ac3d09a8720a8b50eec144eafa624185860afded37f51906c4b319a54e10df1ba8068aa3de13ab2ad145d9cceacfc2049f2d7356c6109bd1529eb9993096c536314a68fff962684d32570deec98d370694e29fa2beae43a705410248e191fc79a436b76eb584e29c4fa48e37db05d9e9e5753cd5911997d1b3dc1f4bb833b3d08ef5086e4ee5a791015911586b3232d674e10ee6c904bf1c6e9c1ed939c357a474270151bddd5c6c7365a8a670b3eb41b9596dfaf1a31190205656383015532dd754dcb07c20d493ca5d5dca76dc2ab95db6c825fc034aad7a4b7ab0ee75de1797e4e5d83b26389787f42d99e708aa40fbaf7e73248b855fc5c8f0947da6257a23f5384d100bac1eafc3a42f5706c69099f3e776a67b2e5c38b111bf82cb805240562d9b0f15e4382b4dc2f3d28500039e44356d46decd7e245777f63283dcd76034b0ca5e8f3c42c8dd00e1b5d586f734e27f1ceda82b02654d5bbc873b397025e0b3960e990ff4b8996364ed87f92124cc4e2d6b601a1215c5883da80b5c7c06a74e23a5699a98b219ba461a774bbc7644326629353dbc4e59f29ee4f2310f4bda0d1733d3cdc55163d3743493b96fa8bc69c0d6cf4f7c1a34b3efb11612e5d4d9dc45777f2445c55f5385d9fe0b6dc59d8c4d49d0d53238e54260a7a23e5f71887854c8f60e365d2657c304cc3fe7b88b93a93d3b1a043350143809147ce0579aeb28b68c1bd3b48401e733468ee2a2c90bd50c7460a140ff75f51557df67e5af08774124f8951dc1fa882f9eff6bcf30dbff4bf35a959e0477110dea2fca2e60f53997e73452b2cf99d654f15ffec7591d22894ab130de9dba012d78a440a2d7f23f4ec96929630fe08e66feeadc384835ba5d7f79c9b94f9149f5805a9e52c8024f2e006befb86231cec1e13c2c93487fae386cdb562aeb82d26ff1db3ea2abfef7a206b79dd4a2b445b74b36973be70d0b06b41fa05e451d021a5e82f003344cb15891d781d403fe1a5fa2cc8224979fa9b2796ed77478cddbffed77fd266da337d42a579116fe40e64e40d0b076596ecf4dbb9a97215ab7b6a3d337a0'),
            firstHop: {
                id: hexToUint8Arr('0332ec4a610781da8b4f349d84a96a959fb7c63a384b6ea80f12dd8d80d70c5d9b'),
                amountMsat: {
                    msat: BigInt(10009)
                },
                delay: 163
            },
            paymentHash: hexToUint8Arr('1b0ba86d9d67e04776f16797bf260ed0c55a7372ededc439028a635e920f1e13'),
            sharedSecrets: [
                hexToUint8Arr('ad9b24b854794ae124fa5e1f36895f1ee9528ba59da25a26f8ed1f569cd23ac5')
            ]
        }

        
        try {
            const response = await node.sendOnion(request)
            console.log('response', response)

            const payResponse = await node.waitSendPay({
                paymentHash: hexToUint8Arr('1b0ba86d9d67e04776f16797bf260ed0c55a7372ededc439028a635e920f1e12')
            })
            console.log(payResponse)
        } catch (e) {
            console.log('error', e)
            return
        }

    });




});


